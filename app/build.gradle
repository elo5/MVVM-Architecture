plugins {
    id "com.github.qingmei2.plugin"
    id "com.android.application"
    id "kotlin-android"
    id "kotlin-android-extensions"
    id "kotlin-kapt"
    id "dagger.hilt.android.plugin"
    id "com.google.protobuf" version "0.8.12"
}

import com.github.qingmei2.plugin.*

android {
    compileSdkVersion BuildVersions.compileSdkVersion

    defaultConfig {
        applicationId "com.qingmei2.sample"
        minSdkVersion BuildVersions.minSdkVersion
        targetSdkVersion BuildVersions.targetSdkVersion
        versionCode BuildVersions.versionCode
        versionName BuildVersions.versionName

        multiDexEnabled true
        testInstrumentationRunner "com.qingmei2.sample.CustomTestRunner"

        Properties properties = new Properties()

        final File propertiesFile = project.rootProject.file('local.properties')
        if (propertiesFile != null && propertiesFile.exists()) {
            properties.load(propertiesFile.newDataInputStream())
            buildConfigField "String", "USER_ACCESS_TOKEN", properties.getProperty("USER_ACCESS_TOKEN")
        } else {
            // add this line just for passing CI.
            buildConfigField "String", "USER_ACCESS_TOKEN", "\"TODO: set token at local.properties\""
        }
    }

    android {
        sourceSets {
            String sharedTestDir = 'src/sharedTest/java'
            test {
                java.srcDirs += sharedTestDir
            }
            androidTest {
                java.srcDirs += sharedTestDir
            }
        }
    }

    // Always show the result of every unit test, even if it passes.
    testOptions.unitTests {
        includeAndroidResources = true

        all {
            testLogging {
                events 'passed', 'skipped', 'failed', 'standardOut', 'standardError'
            }
        }
    }

    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.pro'
        }
    }

    compileOptions {
        sourceCompatibility JavaVersion.VERSION_1_8
        targetCompatibility JavaVersion.VERSION_1_8
    }
    kotlinOptions {
        jvmTarget = '1.8'
        freeCompilerArgs += ["-Xopt-in=kotlin.RequiresOptIn"]
    }

    lintOptions {
        checkReleaseBuilds false
        abortOnError false
    }
}

dependencies {
    implementation fileTree(include: ['*.jar'], dir: 'libs')
    implementation project(':architecture-core')
    implementation project(':module_protobuf')

    implementation Dependencies.appcompat
    implementation Dependencies.recyclerview
    implementation Dependencies.materialDesign
    implementation Dependencies.constraintlayout
    implementation Dependencies.flexbox
    implementation Dependencies.swiperefreshlayout

    implementation 'de.hdodenhof:circleimageview:2.2.0'
    implementation 'com.cpacm:floatingmusicmenu:1.0.0'

    implementation 'com.facebook.stetho:stetho:1.5.1'

    // AndroidX Test - JVM testing
    implementation Dependencies.androidXTestCore
    testImplementation Dependencies.androidXKtxTestCore
    androidTestImplementation Dependencies.androidXKtxTestCore

    debugImplementation Dependencies.leakCanaryDebug
    debugImplementation Dependencies.leakCanaryDebugSupport
    releaseImplementation Dependencies.leakCanaryRelease

    kapt Dependencies.glideCompiler
    kapt Dependencies.roomCompiler
    kapt Dependencies.lifecycleCompiler

    implementation Dependencies.daggerHilt
    kapt Dependencies.daggerHiltCompiler

    testImplementation Dependencies.junit4
    testImplementation Dependencies.junit4Ktx
    androidTestImplementation Dependencies.junit4Ktx

    testImplementation Dependencies.kotlinCoroutinesTestLibrary
    testImplementation Dependencies.archCoreTesting
    androidTestImplementation Dependencies.kotlinCoroutinesTestLibrary

    androidTestImplementation Dependencies.espresso
    androidTestImplementation Dependencies.espressoContrib
    androidTestImplementation Dependencies.espressoIdlingResource

    testImplementation Dependencies.testRunner
    testImplementation Dependencies.testRules
    testImplementation Dependencies.gson
    testImplementation Dependencies.robolectric
    androidTestImplementation Dependencies.testRunner
    androidTestImplementation Dependencies.testRules

    androidTestImplementation Dependencies.benchmark

    androidTestImplementation Dependencies.daggerHiltTest
    testImplementation Dependencies.daggerHiltTest
    kaptAndroidTest Dependencies.daggerHiltCompiler
    kaptTest Dependencies.daggerHiltCompiler
    androidTestImplementation Dependencies.archCoreTesting
}

kapt {
    arguments {
        arg("room.schemaLocation", "$projectDir/schemas".toString())
    }
}
